# 文件操作

C++文件操作主要分为 2 类，即读文件和写文件，本章将介绍常见的C++文件操作，包括（但不限于）打开文件、读取和追加数据、插入和删除数据、关闭文件、删除文件等。

为了方便用户实现文件操作，C++提供了 3 个文件流类，分别是 ofstream（实现写文件）、ifstream（实现读文件）以及 fstream（实现读写文件），它们统称为“文件流类”。

关于文件操作，虽然在 C++ 程序中可以继续沿用 C 语言的那套文件操作方式，但更推荐使用适当的文件流类来读写文件。

## 一、计算机文件到底是什么

内存中存放的数据在计算机关机后就会消失。要长久保存数据，就要使用硬盘、光盘、U 盘等设备。为了便于数据的管理和检索，引入了“文件”的概念。

一篇文章、一段视频、一个可执行程序，都可以被保存为一个文件，并赋予一个文件名。操作系统以文件为单位管理磁盘中的数据。

成千上万个文件如果不加分类放在一起，用户使用起来显然非常不便，因此又引入了树形目录（目录也叫文件夹）的机制，可以把文件放在不同的文件夹中，文件夹中还可以嵌套文件夹，这就便于用户对文件进行管理和使用，正如 Windows 的资源管理器呈现的那样。

一般来说，文件可分为文本文件、视频文件、音频文件、图像文件、可执行文件等多种类别，这是从文件的功能进行分类的。从数据存储的角度来说，**所有的文件本质上都是一样的，都是由一个个字节组成的，归根到底都是 0、1 比特串**。不同的文件呈现出不同的形态（有的是文本，有的是视频等等），这主要是文件的创建者和解释者（使用文件的软件）约定好了文件格式。

所谓“格式”，就是关于文件中每一部分的内容代表什么含义的一种约定。例如，常见的纯文本文件（也叫文本文件，扩展名通常是“.txt”），指的是能够在 Windows 的“记事本”程序中打开，并且能看出是一段有意义的文字的文件。文本文件的格式可以用一句话来描述：文件中的每个字节都是一个可见字符的 ASCII 码。

除了纯文本文件外，图像、视频、可执行文件等一般被称作“二进制文件”。二进制文件如果用“记事本”程序打开，看到的是一片乱码。

所谓“文本文件”和“二进制文件”，只是约定俗成的、从计算机用户角度出发进行的分类，并不是计算机科学的分类。因为从计算机科学的角度来看，所有的文件都是由二进制位组成的，都是二进制文件。文本文件和其他二进制文件只是格式不同而已。

实际上，只要规定好格式，而且不怕浪费空间，用文本文件一样可以表示图像、声音、视频甚至可执行程序。简单地说，如果约定用字符 '1'、'2'、...、'7' 表示七个音符，那么由这些字符组成的文本文件就可以被遵从该约定的音乐软件演奏成一首曲子。

下面再看一个用文本文件表示一幅图像的例子：一幅图像实际上就是一个由点构成的矩阵，每个点可以有不同的颜色，称为像素。有的图像是 256 色的，有的是 32 位真彩色（即一 个像素的颜色用一个 32 位的整数表示）的。

以 256 色图像为例，可以用 0~255 这 256 个数代表 256 种颜色，那么每个像素就可以用一个数来表示。再约定文件开始的两个数代表图像的宽度和高度（以像素为单位），则以下文本文件就可以表示一幅宽度为 6 像素、高度为 4 像素的 256 色图像：

```
6 4
24 0 38 129 4 154
12 73 227 40 0 0
12 173 127 20 0 0
21 73 87 230 1 0
```

这个“文本图像”文件的格式可以描述为：第一行的两个数分别代表水平方向的像素数目和垂直方向的像素数目，此后每行代表图像的一行像素，一行中的每个数对应于一个像素，表示其颜色。理解这一格式的图像处理软件就可以把上述文本文件呈现为一幅图像。视频是由每秒 24 幅图像组成的，因此用文本文件也可以表示视频。

上面用文本文件表示图像的方法是非常低效的，浪费了太多的空间。文件中大量的空格是一种浪费。另外，常常要用 2 个甚至 3 个字符来表示一个像素，也造成大量浪费，因为**用一个字节就足以表示 0~255 这 256 个数**。因此，可以约定一个更节省空间的格式来表示一个 256 色的图像，此种文件格式的描述如下：文件中的第 0 和第 1 个字节是整数 n，代表图像的宽度（2 字节的 n 的取值范围是 0~65 535，说明图像最多只能是 65 535 个像素宽），第 2 和第 3 个字节代表图像的高度。接下来，每 n 个字节表示图像的一行像素，其中每个字节对应于一个像素的颜色。

用这种格式存储 256 色图像，比用上面的文本格式存储图像能够大大节省空间。在“记事本”程序中打开它，看到的就会是乱码，这个图像文件也就是所谓的“二进制文件”。

真正的图像文件、音频文件、视频文件的格式都比较复杂，有的还经过了压缩，但只要文件的制作软件和解读软件（如图像查看软件，音频、视频播放软件）遵循相同的格式约定，用户就可以在文件解读软件中看到文件的内容。