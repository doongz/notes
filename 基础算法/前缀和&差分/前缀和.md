# [å‰ç¼€å’Œ](https://oi-wiki.org/basic/prefix-sum/)

`æ„Ÿè°¢`  ç‚¹èµ StarğŸŒŸ [https://github.com/DoWalle/algorithm](https://github.com/DoWalle/algorithm)

`å‘å¸ƒ`  Gitbook [https://dowalle.gitbook.io/algo/](https://dowalle.gitbook.io/algo/)

å‰ç¼€å’Œæ˜¯ä¸€ç§é‡è¦çš„é¢„å¤„ç†ï¼Œèƒ½å¤§å¤§é™ä½æŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦ã€‚å¯ä»¥ç®€å•ç†è§£ä¸º **æ•°åˆ—çš„å‰né¡¹çš„å’Œ**ã€‚

å®é™…ä¸­ï¼ŒçœŸæ­£ç”¨çš„æ˜¯ã€Œå‰ç¼€å’Œæ€æƒ³ã€

- **ä½†å‰/åç¼€å’Œä¸ä¸€å®šè¦è®°å½•å’Œï¼Œè¿˜å¯ä»¥è®°å½• i ç‚¹å‰/åæ»¡è¶³æ¡ä»¶çš„ä¸ªæ•°ï¼Œè®°å½•i ç‚¹å‰/åä»»ä½•å¯ä»¥è´¡çŒ®çš„æ•°æ®**

- **ã€Œå‰ç¼€å’Œ+å“ˆå¸Œè¡¨ã€ï¼šç»å¸¸ä¼šç”¨å“ˆå¸Œè¡¨ä¿å­˜è®¡ç®—è¿‡çš„å‰ç¼€å’Œï¼Œæ–¹ä¾¿ç”¨O(1)çš„æ—¶é—´å»æŸ¥æ‰¾è®¡ç®—è¿‡çš„å€¼**

## ä¸€ç»´å‰ç¼€å’Œ

æœ‰ n ä¸ªçš„æ­£æ•´æ•°æ”¾åˆ°æ•°ç»„ A é‡Œï¼Œç°åœ¨è¦æ±‚ä¸€ä¸ªæ–°çš„æ•°ç»„ pre_sumï¼Œæ–°æ•°ç»„çš„ç¬¬ i ä¸ªæ•°pre_sum[i] æ˜¯åŸæ•°ç»„ A ç¬¬ 0 åˆ°ç¬¬ i ä¸ªæ•°çš„å’Œ

```
pre_sum[0] = A[0]ï¼Œå¯¹äºi>0 åˆ™ pre_sum[i] = pre_sum[i-1] + A[i]
```

```python
n = 5
A = [i for i in range(n)]
# A: [0, 1, 2, 3, 4]

# è®¡ç®—ä¸€ç»´å‰ç¼€å’Œ
pre_sum = [0 for _ in range(n)]
pre_sum[0] = A[0]
for i in range(1, n):
    pre_sum[i] = pre_sum[i-1] + A[i]
# pre_sum: [0, 1, 3, 6, 10]

# æ›´å¸¸ç”¨çš„æ–¹æ³•ï¼Œä¹‹åç”¨pre_sumçš„æ—¶å€™ï¼Œæ–¹ä¾¿å¤„ç† pre_sum[i] - pre_sum[i-1]
pre_sum = [0 for _ in range(n+1)]
for i in range(n):
    pre_sum[i+1] = pre_sum[i] + A[i]
# pre_sum: [0, 0, 1, 3, 6, 10]
```

## åç¼€å’Œ

- åç¼€å’Œä¸­çš„æ¯ä¸ªå…ƒç´ ç›¸å½“äºä»¥è¯¥å…ƒç´ ä¸‹æ ‡ä¸ºèµ·ç‚¹åˆ°ç»“å°¾çš„ç´¯ç§¯å’Œ
- åç¼€å’Œæ•°ç»„çš„æœ€åä¸€ä¸ªæ•°ä¸å‰ç¼€å’Œæ•°ç»„çš„æœ€åä¸€ä¸ªæ•°ä¸€æ ·

```
nums = [-3, 2, -3, 4, 2]
suf_sum = [2, 5, 3, 6, 2]
ä»¥ 0 ä½ç½®ä¸ºèµ·ç‚¹è®¡ç®—ç´¯ç§¯å’Œä¸ºï¼š2
ä»¥ 1 ä½ç½®ä¸ºèµ·ç‚¹è®¡ç®—ç´¯ç§¯å’Œä¸ºï¼š5
ä»¥ 2 ä½ç½®ä¸ºèµ·ç‚¹è®¡ç®—ç´¯ç§¯å’Œä¸ºï¼š3
ä»¥ 3 ä½ç½®ä¸ºèµ·ç‚¹è®¡ç®—ç´¯ç§¯å’Œä¸ºï¼š6
ä»¥ 4 ä½ç½®ä¸ºèµ·ç‚¹è®¡ç®—ç´¯ç§¯å’Œä¸ºï¼š2
```

## äºŒç»´å‰ç¼€å’Œ

æ¯”å¦‚æˆ‘ä»¬æœ‰è¿™æ ·ä¸€ä¸ªçŸ©é˜µ $$a$$ï¼Œå¯ä»¥è§†ä¸ºäºŒç»´æ•°ç»„ï¼š

```
1 2 4 3
5 1 2 4
6 3 5 9
```

å†å®šä¹‰ä¸€ä¸ªçŸ©é˜µ$$sum$$ï¼Œä½¿$$sum_{x,y} = \sum\limits_{i=1}^{x} \sum\limits_{i=1}^{y} a_{x,y}$$ é‚£ä¹ˆè¿™ä¸ªçŸ©é˜µé•¿è¿™æ ·ï¼š

```
1  3  7  10
6  9  15 22
12 18 29 45
```

é€’æ¨æ±‚çŸ©é˜µ$$sum$$ï¼Œï¼š

$$
sum_{x,y} = sum_{x-1,y} + sum_{x,y-1} - sum_{x-1,y-1} + a_{x,y}
$$

<img src="./doc/å‰ç¼€å’ŒçŸ©é˜µ.png" alt="å‰ç¼€å’ŒçŸ©é˜µ" style="zoom:30%;" />

æ±‚$$(x_1,y_1)-(x_2,y_2)$$å­çŸ©é˜µçš„å’Œï¼š
$$
sub = sum_{x_2,y_2} - sum_{x_1-1,y_2} - sum_{x_2,y_1-1} + sum_{x_1-1,y_1-1}
$$

<img src="./doc/å­çŸ©é˜µ.png" alt="å­çŸ©é˜µ" style="zoom:30%;" />

**ä¾‹é¢˜**

ä¾‹1ï¼š[1074-[äºŒç»´å‰ç¼€å’Œ+ä¼˜åŒ–æšä¸¾+å“ˆå¸Œè¡¨]-å…ƒç´ å’Œä¸ºç›®æ ‡å€¼çš„å­çŸ©é˜µæ•°é‡](./ä¾‹é¢˜/1074-[äºŒç»´å‰ç¼€å’Œ+ä¼˜åŒ–æšä¸¾+å“ˆå¸Œè¡¨]-å…ƒç´ å’Œä¸ºç›®æ ‡å€¼çš„å­çŸ©é˜µæ•°é‡.md)

- é€šè¿‡ã€Œç‚¹ã€æ¥ç¡®å®šä¸€ä¸ªå­çŸ©é˜µï¼Œå³ä¸‹è§’å’Œå·¦ä¸Šè§’ï¼Œæ—¶é—´å¤æ‚åº¦ `O(n^4)`

- é€šè¿‡ã€Œè¾¹ã€æ¥ç¡®å®šä¸€ä¸ªå­çŸ©é˜µï¼Œæ—¶é—´å¤æ‚åº¦ `O(n^3)`



ä¾‹2ï¼š[304. äºŒç»´åŒºåŸŸå’Œæ£€ç´¢ - çŸ©é˜µä¸å¯å˜](https://leetcode-cn.com/problems/range-sum-query-2d-immutable/)

**æ³¨ï¼šä¸Šè¾¹ç•Œå’Œå·¦è¾¹å±Šç”¨0å¡«å……ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢ä¹‹åå–å€¼çš„æ—¶å€™è¶Šç•Œ**

```python
class NumMatrix:

    def __init__(self, matrix: List[List[int]]):
        rows = len(matrix)
        cols = len(matrix[0])
        self.pre_sum = [[0 for _ in range(cols+1)] for _ in range(rows+1)]
        # è®¡ç®—äºŒç»´å‰ç¼€å’Œ
        for r in range(rows):
            for c in range(cols):
                self.pre_sum[r+1][c+1] = self.pre_sum[r+1][c] + self.pre_sum[r][c+1] - self.pre_sum[r][c] + matrix[r][c]

    def sumRegion(self, row1: int, col1: int, row2: int, col2: int) -> int:
        return self.pre_sum[row2+1][col2+1] - self.pre_sum[row2+1][col1] - self.pre_sum[row1][col2+1] + self.pre_sum[row1][col1]
```



ä¾‹3ï¼šåœ¨ä¸€ä¸ª rows x cols çš„åªåŒ…å« 0 å’Œ 1 çš„çŸ©é˜µ a é‡Œæ‰¾å‡ºä¸€ä¸ªä¸åŒ…å« 0 çš„æœ€å¤§æ­£æ–¹å½¢ï¼Œè¾“å‡ºè¾¹é•¿ã€‚

```python
b = [[0 for _ in range(cols)] for _ in range(rows)]
b[0][0] = a[0][0]

# åˆå§‹åŒ–ä¸Šè¾¹ç•Œ
for c in range(1, cols):
    b[0][c] = b[0][c-1] + a[0][c]
# åˆå§‹åŒ–å·¦è¾¹å±Š
for r in range(1, rows):
    b[r][0] = b[r-1][0] + a[r][0]

# è®¡ç®—äºŒç»´å‰ç¼€å’Œ
for r in range(1, rows):
    for c in range(1, cols):
        b[r][c] = b[r][c-1] + b[r-1][c] - b[r-1][c-1] + a[r][c]

ans = float("-inf")
side = 2   # è¾¹é•¿
while side < min(n, m):
    # å½“å˜é•¿ä¸ºsideæ—¶æœç´¢æ‰€æœ‰å¯èƒ½ï¼Œæœç´¢èŒƒå›´åœ¨side<=r<rows, side<=c<colsçš„åŒºåŸŸ
    for r in range(side, rows):
        for c in range(side, cols):
            # å­çŸ©é˜µå³ä¸‹è§’çš„ç‚¹ä¸º[r][c]ï¼Œå·¦ä¸Šè§’çš„ç‚¹ä¸º[r-side+1][c-side+1]
            # å­çŸ©é˜µå†…1çš„å’Œ ç­‰äº è¾¹é•¿çš„å¹³æ–¹æ—¶ ä¸ºæ­£æ–¹å½¢
            if b[r][c] - b[r-side][c] - b[r][c-side] + b[r-side][c-side] == side*side:
                ans = max(ans, side)
    side += 1
print(ans)
```

## åŸºäº DP è®¡ç®—é«˜ç»´å‰ç¼€å’Œ

è¿˜æ²¡çœ‹æ‡‚

https://oi-wiki.org/basic/prefix-sum/

## å‰ç¼€å’Œ+å“ˆå¸Œè¡¨

ä¸å°‘é¢˜éƒ½éœ€è¦ç”¨hashmapåšè®°å½•

## ä¾‹é¢˜

[2121-[éå¸¸è§„å‰ã€åç¼€å’Œ]-ç›¸åŒå…ƒç´ çš„é—´éš”ä¹‹å’Œ](../../å‘¨èµ›/ç¬¬ 273 åœºå‘¨èµ›/2121-[éå¸¸è§„å‰ã€åç¼€å’Œ]-ç›¸åŒå…ƒç´ çš„é—´éš”ä¹‹å’Œ.md)
