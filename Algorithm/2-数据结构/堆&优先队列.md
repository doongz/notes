# å †&ä¼˜å…ˆé˜Ÿåˆ—

å‚è€ƒï¼š[https://oi-wiki.org/ds/heap/](https://oi-wiki.org/ds/heap/)

å †ï¼ˆäºŒå‰å †ï¼‰æ˜¯ä¸€æ£µæ ‘ï¼Œå…¶æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªé”®å€¼ï¼Œä¸”æ¯ä¸ªèŠ‚ç‚¹çš„é”®å€¼éƒ½å¤§äºç­‰äº/å°äºç­‰äºå…¶çˆ¶äº²çš„é”®å€¼ã€‚

æ¯ä¸ªèŠ‚ç‚¹çš„é”®å€¼éƒ½å¤§äºç­‰äºå…¶çˆ¶äº²é”®å€¼çš„å †å«åšå°æ ¹å †ï¼Œå¦åˆ™å«åšå¤§æ ¹å †ã€‚

ä¸€äº›åŠŸèƒ½å¼ºå¤§çš„å †ï¼ˆå¯å¹¶å †ï¼‰è¿˜èƒ½ï¼ˆé«˜æ•ˆåœ°ï¼‰æ”¯æŒ merge ç­‰æ“ä½œã€‚æ”¯æŒå¯æŒä¹…åŒ–ï¼Œä¹Ÿå°±æ˜¯å¯¹ä»»æ„å†å²ç‰ˆæœ¬è¿›è¡ŒæŸ¥è¯¢æˆ–è€…æ“ä½œï¼Œäº§ç”Ÿæ–°çš„ç‰ˆæœ¬ã€‚

**ç¼ºç‚¹æ˜¯ä¸æ”¯æŒåˆ é™¤ä»»æ„ä¸€ä¸ªå€¼**

**ï¼ˆå°æ ¹ï¼‰å †ä¸»è¦æ”¯æŒçš„æ“ä½œåŠæ—¶é—´å¤æ‚åº¦ï¼š**

æ’å…¥ä¸€ä¸ªæ•° `O(log n)`

æŸ¥è¯¢æœ€å°å€¼ `O(1)`

åˆ é™¤æœ€å°å€¼ `O(log n)`

åˆå¹¶ä¸¤ä¸ªå † `O(n)`

å‡å°ä¸€ä¸ªå…ƒç´ çš„å€¼ `O(log n)`



## åº”ç”¨

åº”ç”¨åœºæ™¯ï¼šæ·»åŠ å€¼çš„æ—¶å€™æ—¶é—´å¤æ‚åº¦åšåˆ°`O(log(n)) `  ï¼Œå–å€¼çš„æ—¶å€™åšåˆ°`O(1)`

**ä½†å †ä»…æ–¹ä¾¿æ“ä½œå †é¡¶çš„å€¼ï¼Œæ€æ ·èƒ½è®©å †ä¹Ÿæ–¹ä¾¿çš„æ“ä½œä¸­é—´æŸä¸ªå…ƒç´ å‘¢ï¼Œé€šè¿‡ç»´æŠ¤ä¸¤ä¸ªå †ï¼ˆå¤§ã€å°æ ¹å †ï¼‰çš„å¤§å°ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªç”±å°åˆ°å¤§çš„åºåˆ—ï¼Œå·¦è¾¹ç»´æŠ¤æˆå¤§æ ¹å †ï¼Œå³è¾¹ç»´æŠ¤æˆå°æ ¹å †ï¼Œä¹Ÿå°±æ˜¯å¤§æ ¹å †çš„æœ€å¤§å€¼ <= å°æ ¹å †çš„æœ€å°å€¼**

<img src="./doc/å¤§å°æ ¹å †.png" alt="å¤§å°æ ¹å †" style="zoom:50%;" />



## [Pythonç”¨æ³•](https://www.jianshu.com/p/801318c77ab5)

**åˆ›å»º & è®¿é—® & åˆ é™¤**

heapqåˆ›å»ºçš„æ˜¯å°æ ¹å †

```python
import heapq

# ç¬¬ä¸€ç§åˆ›å»ºæ–¹å¼
nums = [2, 3, 5, 1, 54, 23, 132]
heap = []
for num in nums:
    heapq.heappush(heap, num)  # åŠ å…¥å † 

print(heap[0])  # 1 å¦‚æœåªæ˜¯æƒ³è·å–æœ€å°å€¼è€Œä¸æ˜¯å¼¹å‡ºï¼Œä½¿ç”¨heap[0]
print([heapq.heappop(heap) for _ in range(len(nums))])
# out: [1, 2, 3, 5, 23, 54, 132]
# æ³¨ï¼šä¸è¦ç›´æ¥å»çœ‹ heapï¼Œå› ä¸ºheapçš„é¡ºåºæ˜¯äºŒå‰å †çš„æŸç§æ’åºï¼Œ
# å½“heapq.heappop æ—¶æ‰ä¼šç”±å°åŠå¤§å¼¹å‡ºæ•°æ®


# ç¬¬äºŒç§åˆ›å»ºæ–¹å¼
nums = [2, 3, 5, 1, 54, 23, 132]
heapq.heapify(nums)

# å¦‚æœéœ€è¦åˆ é™¤å †ä¸­æœ€å°å…ƒç´ å¹¶åŠ å…¥ä¸€ä¸ªå…ƒç´ ï¼Œ
heapq.heapreplace(nums, 10)
# å †æ’åºç»“æœ [2, 3, 5, 10, 23, 54, 132]

# è·å–å †æœ€å¤§æˆ–æœ€å°å€¼ï¼Œä¸å¸¸ç”¨
print(heapq.nlargest(4, nums)) 	# [132, 54, 23, 10]
print(heapq.nsmallest(4, nums))	# [2, 3, 5, 10]
```



**å¸¦æƒå€¼çš„ä¼˜å…ˆé˜Ÿåˆ—ï¼Œä¹Ÿå¯ä½œä¸ºå¤šçº§æ’åº**

```python
import heapq

# å°æ ¹å †ç”¨æ³•
priorityQueue = [] 

# ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å€¼ï¼Œä½œä¸ºä¼˜å…ˆçº§ï¼Œç¬¬äºŒä¸ªå€¼å¯ä»¥å­˜æƒå€¼
heapq.heappush(priorityQueue, (5, 'write code')) 
heapq.heappush(priorityQueue, (7, 'release product'))
heapq.heappush(priorityQueue, (1, 'write spec'))
heapq.heappush(priorityQueue, (3, 'create tests'))

v, s = heapq.heappop(priorityQueue) 
# v:1 s:"write spec"
print([heapq.heappop(priorityQueue) for _ in range(len(priorityQueue))])
# [(3, 'create tests'), (5, 'write code'), (7, 'release product')]

hp = [] 
heapq.heappush(hp, (1, 'a')) 
heapq.heappush(hp, (2, 'ab'))
heapq.heappush(hp, (3, 'ac'))
heapq.heappush(hp, (3, 'cb'))

print([heapq.heappop(hp) for _ in range(len(hp))])
# [(1, 'a'), (2, 'ab'), (2, 'ac'), (2, 'cb')]
# å¯ä»¥çœ‹åˆ°å½“ç¬¬ä¸€é¡¹ç›¸åŒæ—¶ï¼Œç¬¬äºŒé¡¹ä¸ºå­—å…¸åº
```



**å®ç°å¤§æ ¹å †**

è‹¥æƒ³ç”¨å¤§æ ¹å †ï¼Œå€¼å…ˆè½¬åŒ–ä¸ºè´Ÿçš„å¤§çš„å˜å°çš„ï¼Œæ”¾è¿›å»ï¼›å–å‡ºæ¥åï¼Œå†æŠŠè´Ÿçš„è½¬åŒ–ä¸ºæ­£çš„ï¼Œå°çš„å˜å¤§

```python
import heapq

nums = [2, 3, 5, 1, 54, 23, 132]
heap = []
for num in nums:
  heapq.heappush(heap, -num) 
  
print([-heapq.heappop(heap) for _ in range(len(nums))])
# [132, 54, 23, 5, 3, 2, 1]
```



**å¦‚æœå †ä¸­çš„å…ƒç´ æ˜¯å¯¹è±¡çš„è¯ï¼Œå¯ä»¥å‚ç…§ [é«˜çº§ç©æ³•-é‡è½½è¿ç®—ç¬¦](../../æ•°æ®æ“ä½œ/Python/é«˜çº§ç©æ³•.md)**

```python
import heapq

class SmallPerson():
    def __init__(self, age, height):
        self.age = age
        self.height = height

    def __lt__(self, other):
        # å°äº <
        if self.age == other.age:
            return self.height < other.height
        else:
            return self.age < other.age


class BigPerson():
    def __init__(self, age, height):
        self.age = age
        self.height = height

    def __lt__(self, other):
        # å°äº <
        if self.age == other.age:
            return self.height > other.height
        else:
            return self.age > other.age


# å°æ ¹å †
hp = []
heapq.heappush(hp, SmallPerson(18, 180))
heapq.heappush(hp, SmallPerson(17, 180))
heapq.heappush(hp, SmallPerson(17, 170))

for _ in range(len(hp)):
    person = heapq.heappop(hp)
    print(person.age, person.height)
# 17 170
# 17 180
# 18 180

# å¤§æ ¹å †
hp = []
heapq.heappush(hp, BigPerson(17, 170))
heapq.heappush(hp, BigPerson(18, 180))
heapq.heappush(hp, BigPerson(17, 180))

for _ in range(len(hp)):
    person = heapq.heappop(hp)
    print(person.age, person.height)
# 18 180
# 17 180
# 17 170
```



**å°è£…ç”¨æ³• æ”¯æŒå¤§å°æ ¹å †ï¼Œä¸æ”¯æŒå¸¦æƒå€¼ï¼Œç»è¿‡å¤šæ¬¡æ¯”èµ›æ„Ÿè§‰ä¸å¦‚ç›´æ¥å†™æ¥çš„è‡ªç„¶**

```python
import heapq

class Heap:
    def __init__(self, name="small"):
        self.arr = []
        self.transform = lambda x: x if name=="small" else -x

    def push(self, num):
        # æ¨å…¥ä¸€ä¸ª
        heapq.heappush(self.arr, self.transform(num))

    def pop(self):
        # å¼¹å‡ºå †é¡¶
        return self.transform(heapq.heappop(self.arr))

    @property
    def top(self):
        # è·å–å †é¡¶å…ƒç´ 
        return self.transform(self.arr[0])
    
    @property
    def length(self):
        return len(self.arr)
    
    @property
    def isEmpty(self):
        return len(self.arr) == 0
```



**æŸç§æ„ä¹‰ä¸Šçš„åˆå¹¶**

heapq æ¨¡å—è¿˜æœ‰ä¸€ä¸ª`heapq.merge(*iterables)` æ–¹æ³•ï¼Œç”¨äºåˆå¹¶å¤šä¸ªæ’åºåçš„åºåˆ—æˆä¸€ä¸ªæ’åºåçš„åºåˆ—ï¼Œ è¿”å›æ’åºåçš„å€¼çš„è¿­ä»£å™¨ã€‚
ç±»ä¼¼äº`sorted(itertools.chain(*iterables))`ï¼Œä½†è¿”å›çš„æ˜¯å¯è¿­ä»£çš„ã€‚

```python
import heapq

num1 = [32, 3, 5, 34, 54, 23, 132]
num2 = [23, 2, 12, 656, 324, 23, 54]
num1 = sorted(num1)
num2 = sorted(num2)

# merge ä¼ å…¥çš„å‚æ•°å¿…é¡»æ˜¯æ’è¿‡ç»­çš„åˆ—è¡¨ï¼Œæ²¡æœ‰æ’åºæˆ–è€…ä¼ å…¥çš„æ˜¯ä¸ªå †éƒ½ä¸è¡Œ
res = heapq.merge(num1, num2)
print(list(res))
# out: [3, 3, 5, 5, 23, 23, 32, 32, 34, 34, 54, 54, 132, 132]
```



### ä¾‹é¢˜

[295. æ•°æ®æµçš„ä¸­ä½æ•°](https://leetcode-cn.com/problems/find-median-from-data-stream/) [5937. åºåˆ—é¡ºåºæŸ¥è¯¢](https://leetcode-cn.com/problems/sequentially-ordinal-rank-tracker/) éƒ½æ˜¯ç»´æŠ¤ä¸¤ä¸ªå †ï¼ˆå¤§ã€å°æ ¹å †ï¼‰çš„å¤§å°



---

`æ„Ÿè°¢`  å¤§å®¶ç‚¹èµ StarğŸŒŸ [https://github.com/dowalle/algorithm](https://github.com/dowalle/algorithm) ç¬”èŠ¯ğŸ¤

`å‘å¸ƒ`  äº Gitbook [https://dowalle.gitbook.io/algo/](https://dowalle.gitbook.io/algo/)
