#### [1314. çŸ©é˜µåŒºåŸŸå’Œ](https://leetcode-cn.com/problems/matrix-block-sum/)

**æ–¹æ³•ï¼šäºŒç»´å‰ç¼€å’Œ**

äºŒç»´å‰ç¼€å’Œè®¡ç®—å…¬å¼ï¼š

[å…³äºå‰ç¼€å’Œçš„æ‰€æœ‰å…¬å¼å¯ä»¥çœ‹çœ‹è¿™é‡Œ](https://dowalle.gitbook.io/algo/ji-chu-suan-fa/qian-zhui-he-cha-fen/qian-zhui-he)
$$
preSum[r][c] = preSum[r][c-1] + preSum[r-1][c] - preSum[r-1][c-1] + mat[r][c]
$$
åˆ†æä¸‹å‰ç¼€å’ŒçŸ©é˜µï¼š

<img src="../doc/1314.png" style="zoom:60%;" />

é€šè¿‡è¿™ä¸ªäºŒç»´çŸ©é˜µï¼Œè®¡ç®—æ»¡è¶³ `i - k <= r <= i + k` å’Œ `j - k <= c <= j + k` æ¡ä»¶çš„å­çŸ©é˜µ

**å…¶å®åªå’Œå›¾ä¸­ã€Œç‚¹aã€å’Œã€Œç‚¹bã€çš„åæ ‡æœ‰å…³ï¼Œä¸­é—´ç‚¹åŠ  k åçš„è¶Šç•Œæƒ…å†µï¼Œä¹Ÿåªä¼šå’Œã€Œç‚¹aã€å’Œã€Œç‚¹bã€çš„åæ ‡æœ‰å…³**

å…ˆå†™å‡ºé€šå¸¸æƒ…å†µä¸‹å­çŸ©é˜µé¢ç§¯çš„è®¡ç®—å…¬å¼ï¼š
$$
sub[r][c] = preSum[d0][d1] - preSum[d0][a1] - preSum[a0][d1] + preSum[a0][a1] \\
\begin{cases} d0=r+k \\ 
d1=c+k \\
a0=r-k-1 \\
a1=c-k-1
\end{cases}
$$
d0, d1, a0, a1 è¿™å››ä¸ªåæ ‡å‡ºç°è¶Šç•Œçš„æƒ…å†µï¼Œåšä¸‹å¤„ç†
$$
\begin{cases} 
d0 = rows-1 &  d0 > rows-1\\ 
d1 = cols-1 & d1 > cols-1 \\
a0 = -1 & a0 < 0 \\
a1 = -1 & a1 < 0
\end{cases}
$$
é—®ï¼šä¸ºå•¥ a0, a1 è¶Šç•Œåç­‰äº -1 

ç­”ï¼šå®é™…åœ¨åšé¢˜çš„æ—¶å€™ä¸€èˆ¬éƒ½ä¼šéƒ½å‰ç¼€å’Œæ•°ç»„è¿›è¡Œæ‰©å……ï¼Œå¤šå¼€ä¸ªå·¦è¾¹å±Šå’Œä¸Šè¾¹ç•Œï¼Œä¹‹ååœ¨preSumä¸­å–å€¼çš„æ—¶å€™ï¼Œåæ ‡éƒ½è¦åŠ ä¸€ã€‚

å½“ a0, a1 è¶Šç•Œåï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯preSumä¸­å–å¾—å€¼ä¸º0ï¼Œ-1 æ˜ å°„åˆ° preSum ä¸­çš„åæ ‡æ˜¯ 0ï¼Œåˆšå¥½èƒ½å–åˆ°å¤šå¼€çš„å·¦è¾¹å±Šå’Œä¸Šè¾¹ç•Œï¼ˆå–å¾—å€¼ä¸º0ï¼‰ã€‚

æ—¶é—´å¤æ‚åº¦ï¼š`O(n^2)`

ç©ºé—´å¤æ‚åº¦ï¼š`O(n^2)`

æ‰§è¡Œç”¨æ—¶ï¼š48 ms, åœ¨æ‰€æœ‰ Python3 æäº¤ä¸­å‡»è´¥äº†96.60%çš„ç”¨æˆ·

å†…å­˜æ¶ˆè€—ï¼š16.1 MB, åœ¨æ‰€æœ‰ Python3 æäº¤ä¸­å‡»è´¥äº†26.38%çš„ç”¨æˆ·

```python
class Solution:
    def matrixBlockSum(self, mat: List[List[int]], k: int) -> List[List[int]]:
        
        rows = len(mat)
        cols = len(mat[0])
        # ä¸ºäº†æ–¹ä¾¿è¾¹ç•Œå¤„ç†ï¼Œå¤šå¼€ä¸ªå·¦è¾¹å±Šå’Œä¸Šè¾¹ç•Œï¼Œæ“ä½œ preSum æ—¶éœ€è¦å°†åæ ‡åŠ ä¸€
        preSum = [[0 for _ in range(cols+1)] for _ in range(rows+1)]
        for r in range(rows):
            for c in range(cols):
                preSum[r+1][c+1] =  preSum[r+1][c] + preSum[r][c+1] - preSum[r][c] + mat[r][c]
        # print(preSum)

        sub = [[0 for _ in range(cols)] for _ in range(rows)]
        for r in range(rows):
            for c in range(cols):
                a0, a1 = r-k-1, c-k-1
                d0, d1 = r+k, c+k
                if d0 > rows-1: d0 = rows-1
                if d1 > cols-1: d1 = cols-1
                if a0 < 0: a0 = -1
                if a1 < 0: a1 = -1
                # print(a0, a1, d0, d1)
                # æ“ä½œ preSum æ—¶éœ€è¦å°†åæ ‡åŠ ä¸€
                sub[r][c] = preSum[d0+1][d1+1] - preSum[d0+1][a1+1] - preSum[a0+1][d1+1] + preSum[a0+1][a1+1]
        return sub
```

`æ„Ÿè°¢`  ç‚¹èµ StarğŸŒŸ [https://github.com/dowalle/algorithm](https://github.com/dowalle/algorithm)

`å‘å¸ƒ`  Gitbook [https://dowalle.gitbook.io/algo/](https://dowalle.gitbook.io/algo/)
