# æ‹“æ‰‘æ’åº

å‚è€ƒï¼š[https://oi-wiki.org/graph/topo/#kahn](https://oi-wiki.org/graph/topo/#kahn)

Topological sorting

## æ€§è´¨

- åœ¨ä¸€ä¸ª [DAG æœ‰å‘æ— ç¯å›¾](https://oi-wiki.org/graph/dag/) ä¸­ï¼Œå°†æ‰€æœ‰èŠ‚ç‚¹æ’åºï¼Œä½¿å¾—æ’åœ¨å‰é¢çš„èŠ‚ç‚¹ä¸èƒ½ä¾èµ–äºæ’åœ¨åé¢çš„èŠ‚ç‚¹ã€‚

- ã€Œæœ‰å‘æ— ç¯å›¾ã€ä¸€å®šæ»¡è¶³ã€Œæ‹“æ‰‘æ’åºã€ï¼Œæ‰€æœ‰ç‚¹æ»¡è¶³ã€Œæ‹“æ‰‘æ’åºã€çš„å›¾ä¸€å®šæ˜¯ã€Œæœ‰å‘æ— ç¯å›¾ã€
- ã€Œæ‹“æ‰‘æ’åºã€ä¸å”¯ä¸€ï¼Œåªè¦æ’åºç›¸å¯¹æœ‰åºå°±è¡Œ

ä¾‹å¦‚ kahn ç®—æ³•å’Œ dfs ç®—æ³•çš„æ‹“æ‰‘æ’åºä¸ä¸€æ ·ï¼Œä½†éƒ½æ˜¯æ‹“æ‰‘æ’åº

- kahn ç®—æ³•çš„æ’åºä¸º [2, 3, 1, 4, 0] 
- dfs ç®—æ³•çš„æ’åºä¸º [3, 4, 2, 1, 0]

<img src="./doc/æ‹“æ‰‘æ’åº.png" alt="æ‹“æ‰‘æ’åº" style="zoom:35%;" />



## kahn ç®—æ³•

æ ¸å¿ƒæ˜¯ç»´æŠ¤ä¸€ä¸ªå…¥åº¦ä¸º 0 ç‚¹çš„é˜Ÿåˆ—

**ç®—æ³•æµç¨‹ï¼š**

1. åˆ›å»ºé‚»æ¥è¡¨å’Œå…¥åº¦è¡¨
2. åˆå§‹çŠ¶æ€ä¸‹ï¼Œæ‰€æœ‰å…¥åº¦ä¸º 0 çš„ç‚¹å…ˆè¿›å…¥é˜Ÿåˆ—
3. æ¯æ¬¡ä»é˜Ÿåˆ—ä¸­å–ä¸€ä¸ªå…¥åº¦ä¸º0çš„ç‚¹`node`ï¼Œæ”¾å…¥topoåˆ—è¡¨ä¸­
4. å°†ç‚¹`node`åé¢çš„ç‚¹`n_node`å…¥åº¦å‡ä¸€ï¼ˆè¡¨æ˜`n_node`å‰é¢çš„é‚£ä¸ªç‚¹`node`è¢«ç§»é™¤äº†ï¼‰
5. å¦‚æœ`n_node`çš„å…¥åº¦ä¸º0ï¼ˆè¡¨æ˜`n_node`å‰é¢æ‰€æœ‰ä¾èµ–çš„ç‚¹éƒ½å·²ç»ç§»é™¤äº†ï¼‰ï¼Œå°±å¯è¿›å…¥é˜Ÿåˆ—é‡å¤ 3ã€4ã€5 è¿‡ç¨‹

**æ³¨æ„ç‚¹ï¼š**

- åˆ†æ¸…æ‹¿é‚£äº›æ•°æ®å»ºç«‹é‚»æ¥è¡¨å’Œå…¥åº¦è¡¨ï¼Œ**ç”¨é¢˜ä¸­å¯èƒ½æˆ–ä¸å¯èƒ½çš„å…³ç³»æ¥å»ºè¡¨**
- å“ªäº›æ•°æ®ä½œä¸ºå®é™…çš„èµ·ç‚¹ï¼Œ**ä¸ä¸€å®šæ˜¯é‚»æ¥è¡¨é‡Œå…¥åº¦ä¸º0çš„ç‚¹ï¼Œè€Œæ˜¯å®é™…åº”ä¸ºèµ·ç‚¹çš„ç‚¹**
- ä¸éœ€è¦ visitedï¼Œå› ä¸ºæœ‰äº›ç‚¹éœ€è¦é‡å¤èµ°åˆ°ï¼Œæ‰å¯ä»¥æŠŠè¿™äº›ç‚¹å‰é¢ä¾èµ–çš„ç‚¹éƒ½ç§»é™¤ï¼ˆè¯¥ç‚¹çš„å…¥åº¦æ‰èƒ½ä»3å‡ä¸º0ï¼‰
- å½“å…¥åº¦ä¸º0ç‚¹å†æ¬¡ç»è¿‡ç¬¬å››æ­¥æ—¶ï¼Œä¼šå˜æˆè´Ÿæ•°ï¼Œè¿™æ¡åˆ†æ”¯å°±æ–­æ‰
- æ‹“æ‰‘æ’åºå¹¶ä¸æ˜¯å”¯ä¸€çš„
- å¦‚æœå›¾ä¸­æœ‰ç¯ï¼Œ`indegree[n_node] == 0`çš„åˆ¤æ–­é˜»æ­¢äº†ç¯ä¸­çš„ç‚¹è¢«èµ°åˆ°ï¼Œæœ€åæ‹“æ‰‘æ’åºä¸­çš„ç‚¹æ•°é‡ä¸ç­‰äºæ‰€æœ‰èŠ‚ç‚¹çš„æ•°é‡

æ—¶é—´å¤æ‚åº¦ï¼š`O(n+m)`ï¼Œå…¶ä¸­ n ä¸ºèŠ‚ç‚¹æ•°ï¼Œm ä¸ºå½“å‰èŠ‚ç‚¹å‰é¢ä¾èµ–çš„èŠ‚ç‚¹æ•°

ç©ºé—´å¤æ‚åº¦ï¼š`O(n+m)`ï¼Œé‚»æ¥è¡¨æ‰€éœ€çš„ç©ºé—´ä¸º`O(n+m)`ï¼Œé˜Ÿåˆ—æ‰€éœ€çš„ç©ºé—´ä¸º`O(n)`

```python
def topo(courses: List[List[int]], numCourses: int) -> bool:
    # numCourses: è¯¾ç¨‹æ•°é‡
    # courses: è¯¾ç¨‹å…³ç³», [a, b] è¦æƒ³å­¦aï¼Œå…ˆå­¦bï¼›å­¦å®Œbï¼Œæ‰èƒ½å­¦a

    adj = collections.defaultdict(list)  # é‚»æ¥è¡¨
    indegree = collections.defaultdict(int)  # å…¥åº¦è¡¨
    topo = []  # æ‹“æ‰‘æ’åº

    # 1ã€åˆ›å»ºé‚»æ¥è¡¨å’Œå…¥åº¦è¡¨
    for a, b in courses:
        adj[b].append(a)
        indegree[a] += 1

    # 2ã€å…¥åº¦ä¸º 0 çš„ç‚¹è¿›å…¥é˜Ÿåˆ—
    queue = collections.deque([k for k in range(numCourses) if indegree[k] == 0])
    while queue:
        node = queue.popleft()
        topo.append(node)  # 3ã€topoä¸­è®°å½•å…¥åº¦ä¸º0çš„ç‚¹
        for n_node in adj[node]:
            # 4ã€èµ°åˆ°ä¸€ä¸ªç‚¹æ—¶å…¥åº¦å‡ä¸€
            indegree[n_node] -= 1
            if indegree[n_node] == 0:
                # 5ã€ä¸‹ä¸€ä¸ªç‚¹å…¥åº¦ä¸º0ï¼Œå¯è¿›å…¥é˜Ÿåˆ—
                queue.append(n_node)

    print(topo)
    print(len(topo) == numCourses)
```



## è®°å¿†åŒ– dfs ç®—æ³•

åŸç†æ˜¯é€šè¿‡ DFS åˆ¤æ–­å›¾ä¸­æ˜¯å¦æœ‰ç¯ã€‚

**ç®—æ³•æµç¨‹ï¼š**

1. å€ŸåŠ©ä¸€ä¸ªæ ‡å¿—åˆ—è¡¨ flagsï¼Œç”¨äºåˆ¤æ–­æ¯ä¸ªèŠ‚ç‚¹ i ï¼ˆè¯¾ç¨‹ï¼‰çš„çŠ¶æ€ï¼š
    - æœªè¢« DFS è®¿é—®ï¼ši == 0
    - å·²è¢«å…¶ä»–èŠ‚ç‚¹å¯åŠ¨çš„ DFS è®¿é—®ï¼ši == -1
    - å·²è¢«å½“å‰èŠ‚ç‚¹å¯åŠ¨çš„ DFS è®¿é—®ï¼ši == 1
2. å¯¹ numCourses ä¸ªèŠ‚ç‚¹ä¾æ¬¡æ‰§è¡Œ DFSï¼Œåˆ¤æ–­æ¯ä¸ªèŠ‚ç‚¹èµ·æ­¥ DFS æ˜¯å¦å­˜åœ¨ç¯ï¼Œè‹¥å­˜åœ¨ç¯ç›´æ¥è¿”å› Falseã€‚DFS æµç¨‹ä¸ºï¼š
    1. ç»ˆæ­¢æ¡ä»¶ï¼š
       - å½“ flags[i] == -1ï¼Œè¯´æ˜å½“å‰è®¿é—®èŠ‚ç‚¹å·²è¢«å…¶ä»–èŠ‚ç‚¹å¯åŠ¨çš„ DFS è®¿é—®ï¼Œæ— éœ€å†é‡å¤æœç´¢ï¼Œç›´æ¥è¿”å› True
       - å½“ flags[i] == 1ï¼Œè¯´æ˜åœ¨æœ¬è½® DFS æœç´¢ä¸­èŠ‚ç‚¹ i è¢«ç¬¬ 2 æ¬¡è®¿é—®ï¼Œ**è¯¾ç¨‹å®‰æ’å›¾æœ‰ç¯** ï¼Œç›´æ¥è¿”å› False
    2. å°†å½“å‰è®¿é—®èŠ‚ç‚¹ i å¯¹åº” flag[i] ç½® 1ï¼Œå³æ ‡è®°å…¶è¢«æœ¬è½® DFS è®¿é—®è¿‡
    3. é€’å½’è®¿é—®å½“å‰èŠ‚ç‚¹ i çš„æ‰€æœ‰é‚»æ¥èŠ‚ç‚¹ jï¼Œå½“å‘ç°ç¯ç›´æ¥è¿”å› False
    4. å½“å‰èŠ‚ç‚¹æ‰€æœ‰é‚»æ¥èŠ‚ç‚¹å·²è¢«éå†ï¼Œå¹¶æ²¡æœ‰å‘ç°ç¯ï¼Œåˆ™å°†å½“å‰èŠ‚ç‚¹ flag ç½®ä¸º âˆ’1 ï¼Œæ”¾å…¥æ‹“æ‰‘æ’åºé‡Œé¢ï¼Œå¹¶è¿”å› True
3. è‹¥æ•´ä¸ªå›¾ DFS ç»“æŸå¹¶æœªå‘ç°ç¯ï¼Œè¿”å› True

**æ³¨æ„ç‚¹ï¼š**

- å½“ä¸€ä¸ªç‚¹è¢«æ ‡è®°ä¸º-1æ—¶è¯´æ˜ä»¥è¯¥ç‚¹åˆ°ä¸‹é¢æ‰€æœ‰çš„è·¯çº¿æ²¡æœ‰ç¯ï¼Œä¸‹æ¬¡é‡åˆ°è¯¥ç‚¹æ—¶ç›´æ¥åˆ¤æ–­ Trueï¼Œè®°å¿†åŒ–dfs
- dfs ç®—æ³•è®°å½•çš„æ‹“æ‰‘æ’åºæ˜¯**é€†åºçš„**

æ—¶é—´å¤æ‚åº¦ï¼š`O(n+m)`ï¼Œéå†ä¸€ä¸ªå›¾éœ€è¦è®¿é—®æ‰€æœ‰èŠ‚ç‚¹å’Œæ‰€æœ‰ä¸´è¾¹ï¼Œn å’Œ m åˆ†åˆ«ä¸ºèŠ‚ç‚¹æ•°é‡å’Œä¸´è¾¹æ•°é‡

ç©ºé—´å¤æ‚åº¦ï¼š`O(n+m)`ï¼Œé‚»æ¥è¡¨æ‰€éœ€çš„ç©ºé—´ä¸º`O(n+m)`ï¼Œflags æ‰€éœ€çš„ç©ºé—´ä¸º`O(n)`

```python
def isTopo(courses, numCourses: int) -> bool:
    # numCourses: è¯¾ç¨‹æ•°é‡
    # courses: è¯¾ç¨‹å…³ç³», [a, b] è¦æƒ³å­¦aï¼Œå…ˆå­¦bï¼›å­¦å®Œbï¼Œæ‰èƒ½å­¦a

    adj = collections.defaultdict(list)  # é‚»æ¥è¡¨
    flags = collections.defaultdict(int)  # æ ‡å¿—è¡¨ï¼Œ0æ²¡è®¿é—®è¿‡ï¼Œ-1å·²è®¿é—®è¿‡ï¼Œ1å½“å‰æ­£åœ¨è®¿é—®
    topo = []  # æ‹“æ‰‘æ’åºçš„é€†åº

    # åˆ›å»ºé‚»æ¥è¡¨
    for a, b in courses:
        adj[b].append(a)

    def dfs(node):
        if flags[node] == -1:
            return True
        if flags[node] == 1:
            return False

        flags[node] = 1
        for n_node in adj[node]:
            if not dfs(n_node):
                return False

        flags[node] = -1
        topo.append(node)
        return True

    # æ¯ä¸ªç‚¹è¿›è¡Œæ— ç¯åˆ¤æ–­
    for n in range(numCourses):
        if not dfs(n):
            return False

    print(topo[::-1])
    return True
```



## ä¾‹é¢˜

[207-[æ‹“æ‰‘æ’åº-æœ‰å‘æ— ç¯å›¾]-è¯¾ç¨‹è¡¨](./ä¾‹é¢˜-é«˜çº§ç®—æ³•/207-[æ‹“æ‰‘æ’åº-æœ‰å‘æ— ç¯å›¾]-è¯¾ç¨‹è¡¨.md)

[5947-[æ‹“æ‰‘æ’åº]-ä»ç»™å®šåŸææ–™ä¸­æ‰¾åˆ°æ‰€æœ‰å¯ä»¥åšå‡ºçš„èœ](../../å‘¨èµ›/ç¬¬ 68 åœºåŒå‘¨èµ›/5947-[æ‹“æ‰‘æ’åº]-ä»ç»™å®šåŸææ–™ä¸­æ‰¾åˆ°æ‰€æœ‰å¯ä»¥åšå‡ºçš„èœ.md)




---

`æ„Ÿè°¢`  å¤§å®¶ç‚¹èµ StarğŸŒŸ [https://github.com/dowalle/algorithm](https://github.com/dowalle/algorithm) ç¬”èŠ¯ğŸ¤

`å‘å¸ƒ`  äº Gitbook [https://dowalle.gitbook.io/algo/](https://dowalle.gitbook.io/algo/)

